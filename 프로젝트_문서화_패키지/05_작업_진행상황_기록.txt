===============================================
ë°”ë‚˜ë‚˜ ì¤‘ê³ ì»´í“¨í„° í”„ë¡œì íŠ¸ - ì‘ì—… ì§„í–‰ìƒí™© ê¸°ë¡
ìµœì¢… ì—…ë°ì´íŠ¸: 2025-11-02
===============================================

## ğŸ“‹ í”„ë¡œì íŠ¸ ê°œìš”

í”„ë¡œì íŠ¸ëª…: ë°”ë‚˜ë‚˜ ì¤‘ê³ ì»´í“¨í„° - ë„ë§¤ ë§¤ì¹­ í”Œë«í¼
ê¸°ìˆ  ìŠ¤íƒ: Next.js 14.2 (App Router) + TypeScript + Supabase (PostgreSQL, Auth, Storage)
ìƒíƒœ ê´€ë¦¬: React Hooks + Context API
ê°œë°œ ìƒíƒœ: ì¸ì¦ ì‹œìŠ¤í…œ 100% ì™„ë£Œ + ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ 100% ì™„ë£Œ

Supabase í”„ë¡œì íŠ¸ ì •ë³´:
- í”„ë¡œì íŠ¸ URL: https://vqypnenjejbtvvvewxee.supabase.co
- ë°ì´í„°ë² ì´ìŠ¤: PostgreSQL (RLS í™œì„±í™”)
- Storage Buckets: business-registrations, product-images, sell-request-images
- ì¸ì¦ ì‹œìŠ¤í…œ: Supabase Auth (ì´ë©”ì¼ í™•ì¸ í•„ìˆ˜)

ë§ˆì´ê·¸ë ˆì´ì…˜ íˆìŠ¤í† ë¦¬:
- 2025-11-01: Flutter Web (Firebase) â†’ Next.js (Supabase) ë§ˆì´ê·¸ë ˆì´ì…˜ ì‹œì‘
- 2025-11-02: ì¸ì¦ ì‹œìŠ¤í…œ, ì‚¬ì—…ì ì¸ì¦, ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ ì™„ë£Œ

===============================================
## âœ… êµ¬í˜„ ì™„ë£Œëœ ê¸°ëŠ¥ (2025-11-02 ìµœì‹ )
===============================================

### 1. ì¸ì¦ ì‹œìŠ¤í…œ âœ… (100% ì™„ë£Œ)
- âœ… ë¡œê·¸ì¸/íšŒì›ê°€ì… (app/(auth)/login/page.tsx, signup/page.tsx)
- âœ… ë¹„ë°€ë²ˆí˜¸ ì¬ì„¤ì • (Supabase Auth ì´ë©”ì¼)
- âœ… ì´ë©”ì¼ í™•ì¸ í•„ìˆ˜ (Supabase Auth)
- âœ… ì‚¬ìš©ì íƒ€ì… êµ¬ë¶„ (ì¼ë°˜ ì‚¬ìš©ì, ë„ë§¤ìƒ, ê´€ë¦¬ì)
- âœ… Custom Hookì„ í†µí•œ ì „ì—­ ì¸ì¦ ìƒíƒœ ê´€ë¦¬ (lib/hooks/use-auth.ts)
- âœ… ì´ë©”ì¼ í™•ì¸ ì½œë°± ì²˜ë¦¬ (app/auth/callback/route.ts)

### 2. ë°ì´í„° ëª¨ë¸ (types/)
- âœ… types/user.ts - ì‚¬ìš©ì ì •ë³´ ë° ì¸ì¦ ìƒíƒœ
  - UserType: NORMAL, WHOLESALER, ADMIN
  - VerificationStatus: NONE, PENDING, APPROVED, REJECTED
- â³ types/product.ts - ìƒí’ˆ ì •ë³´ (ëŒ€ê¸°)
- â³ types/inquiry.ts - ë¬¸ì˜ ì •ë³´ (ëŒ€ê¸°)
- â³ types/sell-request.ts - ë§¤ì… ìš”ì²­ ì •ë³´ (ëŒ€ê¸°)
- â³ types/purchase-offer.ts - ë§¤ì… ì œì•ˆ ì •ë³´ (ëŒ€ê¸°)

### 3. ì‚¬ì—…ì ì¸ì¦ ì‹œìŠ¤í…œ âœ… (100% ì™„ë£Œ)
- âœ… íšŒì›ê°€ì… ì‹œ ì‚¬ì—…ì ë“±ë¡ì¦ ì—…ë¡œë“œ (components/auth/signup-form.tsx)
  - Server-side API routeë¡œ íŒŒì¼ ì—…ë¡œë“œ (/api/upload-business-registration)
  - Service Role Keyë¡œ RLS ìš°íšŒ
  - íŒŒì¼ëª… í˜•ì‹: {userId}/{userId}_{timestamp}.{ext}
- âœ… ì´ë©”ì¼ í™•ì¸ í›„ ìë™ DB ì—…ë°ì´íŠ¸ (app/auth/callback/route.ts)
  - Storageì—ì„œ íŒŒì¼ í™•ì¸
  - business_registration_url ìë™ ì €ì¥
  - verification_statusë¥¼ 'pending'ìœ¼ë¡œ ìë™ ë³€ê²½
- âœ… ê´€ë¦¬ì ìŠ¹ì¸/ê±°ë¶€ ì‹œìŠ¤í…œ (app/(main)/admin/dashboard/page.tsx)
  - ìŠ¹ì¸: verification_status = 'approved'
  - ê±°ë¶€: verification_status = 'rejected', user_type = 'normal'
- âœ… ì‚¬ì—…ì ë“±ë¡ì¦ ë¯¸ë¦¬ë³´ê¸°/ë‹¤ìš´ë¡œë“œ ê¸°ëŠ¥
  - PDFì™€ ì´ë¯¸ì§€ ëª¨ë‘ ì§€ì›
  - iframeìœ¼ë¡œ PDF í‘œì‹œ
  - ë‹¤ìš´ë¡œë“œ ë²„íŠ¼ ì œê³µ

### 4. ê´€ë¦¬ì ê¸°ëŠ¥ âœ… (100% ì™„ë£Œ)
- âœ… ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ (app/(main)/admin/dashboard/page.tsx)
  - ìŠ¹ì¸ ëŒ€ê¸° ì¤‘ì¸ ë„ë§¤ìƒ ëª©ë¡
  - ìŠ¹ì¸/ê±°ë¶€ ì²˜ë¦¬
  - ì‚¬ì—…ì ë“±ë¡ì¦ ë¯¸ë¦¬ë³´ê¸°/ë‹¤ìš´ë¡œë“œ
  - ì‹¤ì‹œê°„ ë°ì´í„° ì—…ë°ì´íŠ¸

### 5. ë°±ì—”ë“œ ì„œë¹„ìŠ¤ (lib/services/)
- âœ… auth.service.ts - íšŒì›ê°€ì…, ë¡œê·¸ì¸, ë¡œê·¸ì•„ì›ƒ
  - Supabase Auth ì—°ë™
  - fetch API ì‚¬ìš© (Supabase í´ë¼ì´ì–¸íŠ¸ hanging ë¬¸ì œ íšŒí”¼)
  - localStorage ê¸°ë°˜ ì„¸ì…˜ ê´€ë¦¬
- âœ… admin.service.ts - ê´€ë¦¬ì ê¸°ëŠ¥
  - localStorageì—ì„œ ì§ì ‘ ì„¸ì…˜ í† í° ì½ê¸°
  - fetch APIë¡œ PostgreSQL REST API í˜¸ì¶œ
  - getPendingWholesalers(), approveWholesaler(), rejectWholesaler()
- âœ… storage.service.ts - íŒŒì¼ ì—…ë¡œë“œ
  - uploadBusinessRegistration() - API route í˜¸ì¶œ
  - validateFile() - íŒŒì¼ ìœ íš¨ì„± ê²€ì‚¬
  - uploadImage(), uploadImages() - ìƒí’ˆ/ë§¤ì… ìš”ì²­ ì´ë¯¸ì§€ (ëŒ€ê¸°)
- â³ product.service.ts - ìƒí’ˆ CRUD (ëŒ€ê¸°)
- â³ inquiry.service.ts - ë¬¸ì˜ ì‘ì„±, ë‹µë³€, ì¡°íšŒ (ëŒ€ê¸°)
- â³ sell-request.service.ts - ë§¤ì… ìš”ì²­/ì œì•ˆ ê´€ë¦¬ (ëŒ€ê¸°)

### 6. Database ì„¤ì • âœ…
- âœ… Database Trigger (handle_new_user)
  - Auth ê°€ì… ì‹œ users í…Œì´ë¸” ìë™ ìƒì„±
  - user_metadataì—ì„œ name, user_type ì¶”ì¶œ
  - verification_status ê¸°ë³¸ê°’: 'none'
- âœ… PostgreSQL Tables
  - users (uid PK, email, name, phone_number, business_registration_url, user_type, verification_status, created_at, updated_at)
  - products (ëŒ€ê¸°)
  - inquiries (ëŒ€ê¸°)
  - sell_requests (ëŒ€ê¸°)
  - purchase_offers (ëŒ€ê¸°)
- âœ… RLS ì •ì±…
  - users: ì„ì‹œë¡œ DISABLE (ê°œë°œ ì¤‘)
  - is_admin() í•¨ìˆ˜: SECURITY DEFINER, SET search_path, STABLE
  - Storage: public read/write í—ˆìš© (business-registrations)

### 7. Storage ì„¤ì • âœ…
- âœ… business-registrations ë²„í‚·
  - ê³µê°œ ì½ê¸° í—ˆìš©
  - ê³µê°œ ì—…ë¡œë“œ í—ˆìš© (íšŒì›ê°€ì… ì‹œ í•„ìš”)
  - íŒŒì¼ ê²½ë¡œ: {userId}/{userId}_{timestamp}.{ext}
- â³ product-images ë²„í‚· (ëŒ€ê¸°)
- â³ sell-request-images ë²„í‚· (ëŒ€ê¸°)

===============================================
## ğŸ”§ í•´ê²°ëœ ì£¼ìš” ë¬¸ì œë“¤
===============================================

### ë¬¸ì œ 1: Supabase í´ë¼ì´ì–¸íŠ¸ Hanging ë¬¸ì œ âš ï¸ (CRITICAL)
ì¦ìƒ:
- `supabase.auth.getSession()` ë¬´í•œ ëŒ€ê¸°
- `supabase.from('users').select()` ë¬´í•œ ëŒ€ê¸°
- ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ ë¡œë”© ë¬´í•œ ëŒ€ê¸°

ì›ì¸:
- RLS ì •ì±…ê³¼ Supabase í´ë¼ì´ì–¸íŠ¸ SDKì˜ ì¶©ëŒë¡œ ì¶”ì •
- íŠ¹íˆ `is_admin()` í•¨ìˆ˜ì™€ì˜ ì¬ê·€ í˜¸ì¶œ ë¬¸ì œ

í•´ê²°ì±…:
```typescript
// âŒ ì•ˆ ë¨ - Supabase í´ë¼ì´ì–¸íŠ¸ ì‚¬ìš©
const { data } = await supabase.auth.getSession();
const { data } = await supabase.from('users').select('*');

// âœ… ì‘ë™ - localStorage + fetch API ì‚¬ìš©
// 1. localStorageì—ì„œ ì§ì ‘ ì„¸ì…˜ í† í° ì½ê¸°
const keys = Object.keys(localStorage);
const authKey = keys.find(key =>
  key.startsWith('sb-') && key.includes('-auth-token')
);
const authData = localStorage.getItem(authKey);
const parsed = JSON.parse(authData);
const sessionToken = parsed?.access_token;

// 2. fetch APIë¡œ ì§ì ‘ í˜¸ì¶œ
const url = `${SUPABASE_URL}/rest/v1/users`;
const response = await fetch(url, {
  headers: {
    'apikey': SUPABASE_ANON_KEY,
    'Authorization': `Bearer ${sessionToken}`,
    'Content-Type': 'application/json',
  },
});
```

ì ìš© íŒŒì¼:
- lib/services/admin.service.ts (getSessionToken ë©”ì„œë“œ)
- lib/services/auth.service.ts (signIn, getCurrentUser)
- app/auth/callback/route.ts (ì´ë©”ì¼ í™•ì¸ í›„ ì²˜ë¦¬)

### ë¬¸ì œ 2: RLS ë¬´í•œ ì¬ê·€ ë¬¸ì œ
ì¦ìƒ: `is_admin()` í•¨ìˆ˜ í˜¸ì¶œ ì‹œ ë¬´í•œ ì¬ê·€ ë°œìƒ

í•´ê²°ì±…:
```sql
CREATE OR REPLACE FUNCTION public.is_admin()
RETURNS BOOLEAN
LANGUAGE plpgsql
SECURITY DEFINER          -- í•¨ìˆ˜ ì†Œìœ ì ê¶Œí•œìœ¼ë¡œ ì‹¤í–‰
SET search_path = public  -- ìŠ¤í‚¤ë§ˆ ê³ ì •
STABLE                    -- ê°™ì€ íŠ¸ëœì­ì…˜ì—ì„œ ìºì‹œ
AS $$
BEGIN
  RETURN EXISTS (
    SELECT 1 FROM public.users
    WHERE uid = auth.uid()
    AND user_type = 'admin'
  );
END;
$$;

ALTER FUNCTION public.is_admin() OWNER TO postgres;
```

### ë¬¸ì œ 3: ì´ë©”ì¼ í™•ì¸ ì „ DB ì—…ë°ì´íŠ¸ ì‹¤íŒ¨
ì¦ìƒ:
- íšŒì›ê°€ì… ì‹œ phone_number ë“±ì´ DBì— ì €ì¥ë˜ì§€ ì•ŠìŒ
- UPDATE ì‹œ ê¶Œí•œ ì—ëŸ¬

ì›ì¸:
- Supabase AuthëŠ” ì´ë©”ì¼ í™•ì¸ ì „ì—ëŠ” ì„¸ì…˜ì„ ìƒì„±í•˜ì§€ ì•ŠìŒ
- ì„¸ì…˜ ì—†ì´ëŠ” RLSì— ì˜í•´ ì°¨ë‹¨ë¨

í•´ê²°ì±…:
```typescript
// lib/services/auth.service.ts
// ì´ë©”ì¼ í™•ì¸ì´ í•„ìš”í•œì§€ ë¨¼ì € ì²´í¬ (UPDATE ì „ì—)
if (!authData.session) {
  console.log('[AuthService] Email confirmation required - skipping UPDATE');
  const error = new Error('ì´ë©”ì¼ í™•ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤...');
  (error as any).code = 'EMAIL_CONFIRMATION_REQUIRED';
  throw error;
}

// ì„¸ì…˜ì´ ìˆëŠ” ê²½ìš°ì—ë§Œ UPDATE ì‹¤í–‰
```

### ë¬¸ì œ 4: ë„ë§¤ìƒ íšŒì›ê°€ì… ì‹œ íŒŒì¼ ì—…ë¡œë“œ hanging
ì¦ìƒ: íŒŒì¼ ì—…ë¡œë“œ í›„ "ê°€ì… ì¤‘..." ë¬´í•œ ëŒ€ê¸°

ì›ì¸:
- Supabase Storage í´ë¼ì´ì–¸íŠ¸ SDKë„ hanging ë¬¸ì œ ë°œìƒ
- RLS ì •ì±…ê³¼ì˜ ì¶©ëŒ

í•´ê²°ì±…:
- Server-side API route ìƒì„± (`/api/upload-business-registration`)
- Service Role Keyë¡œ RLS ìš°íšŒ
- í´ë¼ì´ì–¸íŠ¸ëŠ” FormDataë¡œ API í˜¸ì¶œ
```typescript
// app/api/upload-business-registration/route.ts
const supabaseAdmin = createClient(
  process.env.NEXT_PUBLIC_SUPABASE_URL!,
  process.env.SUPABASE_SERVICE_ROLE_KEY!,  // Service Role Key ì‚¬ìš©
  {
    auth: {
      autoRefreshToken: false,
      persistSession: false,
    },
  }
);

// Storage ì—…ë¡œë“œ
const { error } = await supabaseAdmin.storage
  .from('business-registrations')
  .upload(filePath, buffer, { ... });
```

### ë¬¸ì œ 5: ì‚¬ì—…ì ë“±ë¡ì¦ URLì´ DBì— ì €ì¥ë˜ì§€ ì•ŠìŒ
ì¦ìƒ:
- íŒŒì¼ì€ Storageì— ì—…ë¡œë“œë¨
- DBì˜ business_registration_urlì€ null

ì›ì¸:
- callback ë¼ìš°íŠ¸ì—ì„œ Supabase í´ë¼ì´ì–¸íŠ¸ ì‚¬ìš© ì‹œ hanging

í•´ê²°ì±…:
- callback ë¼ìš°íŠ¸ë„ fetch APIë¡œ ë³€ê²½
- Service Role Keyë¡œ Storage ì ‘ê·¼
- localStorage ì„¸ì…˜ í† í°ìœ¼ë¡œ DB ì—…ë°ì´íŠ¸

```typescript
// app/auth/callback/route.ts
// 1. Service Role Keyë¡œ Storage íŒŒì¼ í™•ì¸
const { data: files } = await supabaseAdmin.storage
  .from('business-registrations')
  .list(userId, {
    limit: 1,
    sortBy: { column: 'created_at', order: 'desc' },
  });

// 2. fetch APIë¡œ DB ì—…ë°ì´íŠ¸
const updateUrl = `${SUPABASE_URL}/rest/v1/users?uid=eq.${userId}`;
const updateResponse = await fetch(updateUrl, {
  method: 'PATCH',
  headers: {
    'apikey': SUPABASE_ANON_KEY,
    'Authorization': `Bearer ${sessionToken}`,
    'Content-Type': 'application/json',
  },
  body: JSON.stringify({
    business_registration_url: publicUrl,
    verification_status: 'pending',
  }),
});
```

===============================================
## ğŸ“ í”„ë¡œì íŠ¸ íŒŒì¼ êµ¬ì¡° (ìµœì‹ )
===============================================

banana-usedcomputer-web/
â”œâ”€â”€ app/                                # Next.js App Router
â”‚   â”œâ”€â”€ (auth)/                         # ì¸ì¦ ë¼ìš°íŠ¸ ê·¸ë£¹
â”‚   â”‚   â”œâ”€â”€ login/
â”‚   â”‚   â”‚   â””â”€â”€ page.tsx               # ë¡œê·¸ì¸ í˜ì´ì§€ âœ…
â”‚   â”‚   â””â”€â”€ signup/
â”‚   â”‚       â””â”€â”€ page.tsx               # íšŒì›ê°€ì… í˜ì´ì§€ âœ…
â”‚   â”œâ”€â”€ (main)/                         # ë©”ì¸ ì•± ë¼ìš°íŠ¸ ê·¸ë£¹
â”‚   â”‚   â”œâ”€â”€ layout.tsx                  # ê³µí†µ ë ˆì´ì•„ì›ƒ (ë„¤ë¹„ê²Œì´ì…˜) âœ…
â”‚   â”‚   â”œâ”€â”€ page.tsx                    # í™ˆ í™”ë©´ âœ…
â”‚   â”‚   â”œâ”€â”€ admin/
â”‚   â”‚   â”‚   â””â”€â”€ dashboard/
â”‚   â”‚   â”‚       â””â”€â”€ page.tsx            # ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ âœ…
â”‚   â”‚   â”œâ”€â”€ products/                   # ìƒí’ˆ ê´€ë ¨ (ëŒ€ê¸°)
â”‚   â”‚   â”œâ”€â”€ sell-requests/              # ë§¤ì… ìš”ì²­ ê´€ë ¨ (ëŒ€ê¸°)
â”‚   â”‚   â””â”€â”€ inquiries/                  # ë¬¸ì˜ ê´€ë ¨ (ëŒ€ê¸°)
â”‚   â”œâ”€â”€ api/                            # Server-side API Routes
â”‚   â”‚   â””â”€â”€ upload-business-registration/
â”‚   â”‚       â””â”€â”€ route.ts                # ì‚¬ì—…ì ë“±ë¡ì¦ ì—…ë¡œë“œ API âœ…
â”‚   â”œâ”€â”€ auth/
â”‚   â”‚   â””â”€â”€ callback/
â”‚   â”‚       â””â”€â”€ route.ts                # ì´ë©”ì¼ í™•ì¸ ì½œë°± âœ…
â”‚   â”œâ”€â”€ globals.css                     # ì „ì—­ ìŠ¤íƒ€ì¼ âœ…
â”‚   â””â”€â”€ layout.tsx                      # ë£¨íŠ¸ ë ˆì´ì•„ì›ƒ âœ…
â”‚
â”œâ”€â”€ components/                         # React ì»´í¬ë„ŒíŠ¸
â”‚   â”œâ”€â”€ auth/
â”‚   â”‚   â”œâ”€â”€ login-form.tsx             # ë¡œê·¸ì¸ í¼ âœ…
â”‚   â”‚   â””â”€â”€ signup-form.tsx            # íšŒì›ê°€ì… í¼ âœ…
â”‚   â””â”€â”€ common/
â”‚       â”œâ”€â”€ loading.tsx                # ë¡œë”© ì»´í¬ë„ŒíŠ¸ âœ…
â”‚       â””â”€â”€ error.tsx                  # ì—ëŸ¬ ì»´í¬ë„ŒíŠ¸ âœ…
â”‚
â”œâ”€â”€ lib/                                # í•µì‹¬ ë¡œì§
â”‚   â”œâ”€â”€ supabase/
â”‚   â”‚   â””â”€â”€ config.ts                   # Supabase í´ë¼ì´ì–¸íŠ¸ ì´ˆê¸°í™” âœ…
â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â”œâ”€â”€ auth.service.ts             # ì¸ì¦ ì„œë¹„ìŠ¤ âœ…
â”‚   â”‚   â”œâ”€â”€ admin.service.ts            # ê´€ë¦¬ì ì„œë¹„ìŠ¤ âœ…
â”‚   â”‚   â””â”€â”€ storage.service.ts          # ìŠ¤í† ë¦¬ì§€ ì„œë¹„ìŠ¤ âœ…
â”‚   â””â”€â”€ hooks/
â”‚       â””â”€â”€ use-auth.ts                 # ì¸ì¦ Hook âœ…
â”‚
â”œâ”€â”€ types/
â”‚   â””â”€â”€ user.ts                         # ì‚¬ìš©ì íƒ€ì… ì •ì˜ âœ…
â”‚
â”œâ”€â”€ constants/
â”‚   â””â”€â”€ routes.ts                       # ë¼ìš°íŠ¸ ê²½ë¡œ âœ…
â”‚
â”œâ”€â”€ í”„ë¡œì íŠ¸_ë¬¸ì„œí™”_íŒ¨í‚¤ì§€/            # ë¬¸ì„œí™” âœ…
â”‚   â”œâ”€â”€ 00_README_ì‹œì‘í•˜ê¸°.md          # í”„ë¡œì íŠ¸ ê°œìš”
â”‚   â”œâ”€â”€ 01_ë°ì´í„°ëª¨ë¸_TypeScript_ì¸í„°í˜ì´ìŠ¤.md
â”‚   â”œâ”€â”€ 02_í™”ë©´ë³„_ìƒì„¸_ê¸°ëŠ¥_ëª…ì„¸ì„œ.md
â”‚   â”œâ”€â”€ 03_Next.js_í”„ë¡œì íŠ¸_êµ¬ì¡°_ì œì•ˆì„œ.md
â”‚   â””â”€â”€ 05_ì‘ì—…_ì§„í–‰ìƒí™©_ê¸°ë¡.txt     # ì´ íŒŒì¼
â”‚
â”œâ”€â”€ .env.local                          # í™˜ê²½ ë³€ìˆ˜ âœ…
â”œâ”€â”€ next.config.js                      # Next.js ì„¤ì • âœ…
â”œâ”€â”€ tailwind.config.ts                  # Tailwind CSS ì„¤ì • âœ…
â”œâ”€â”€ tsconfig.json                       # TypeScript ì„¤ì • âœ…
â””â”€â”€ package.json                        # íŒ¨í‚¤ì§€ ì •ë³´ âœ…

===============================================
## ğŸ¯ í”„ë¡œì íŠ¸ ì‹¤í–‰ ëª…ë ¹ì–´
===============================================

### ìµœì´ˆ ì‹¤í–‰ ì‹œ:
```bash
cd /Volumes/WD_BLACK/Project_doing/banana_usedcomputer_web
npm install
npm run dev
```

### ìºì‹œ ì‚­ì œ í›„ ì¬ì‹œì‘:
```bash
rm -rf .next
npm install
npm run dev
```

### í”„ë¡œë•ì…˜ ë¹Œë“œ:
```bash
npm run build
npm start
```

### ê°œë°œ ì„œë²„ (í¬íŠ¸ 3000):
```bash
npm run dev
```

ë¸Œë¼ìš°ì €ì—ì„œ http://localhost:3000 ì ‘ì†

===============================================
## ğŸ” í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤
===============================================

### 1. ì¼ë°˜ ì‚¬ìš©ì íšŒì›ê°€ì… ë° ë¡œê·¸ì¸:

1. http://localhost:3000/signup ì ‘ì†
2. íšŒì›ê°€ì… í¼ ì‘ì„±:
   - ì´ë©”ì¼: test@example.com
   - ë¹„ë°€ë²ˆí˜¸: test1234
   - ì´ë¦„: í…ŒìŠ¤íŠ¸ ì‚¬ìš©ì
   - ì‚¬ìš©ì íƒ€ì…: ì¼ë°˜ ì‚¬ìš©ì ì„ íƒ
3. íšŒì›ê°€ì… ë²„íŠ¼ í´ë¦­
4. "ì´ë©”ì¼ í™•ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤" ë©”ì‹œì§€ í™•ì¸
5. ì´ë©”ì¼ í™•ì¸ ë§í¬ í´ë¦­
6. ìë™ìœ¼ë¡œ users í…Œì´ë¸”ì— ë°ì´í„° ìƒì„±ë¨
7. ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™í•˜ì—¬ ë¡œê·¸ì¸

### 2. ë„ë§¤ìƒ íšŒì›ê°€ì… (ì‚¬ì—…ì ë“±ë¡ì¦ ì—…ë¡œë“œ):

1. http://localhost:3000/signup ì ‘ì†
2. íšŒì›ê°€ì… í¼ ì‘ì„±:
   - ì´ë©”ì¼: wholesaler@example.com
   - ë¹„ë°€ë²ˆí˜¸: test1234
   - ì´ë¦„: ë°”ë‚˜ë‚˜ì»´í¼ë‹ˆ
   - ì „í™”ë²ˆí˜¸: 010-1234-5678
   - ì‚¬ìš©ì íƒ€ì…: ë„ë§¤ìƒ ì„ íƒ
3. ì‚¬ì—…ì ë“±ë¡ì¦ íŒŒì¼ ì—…ë¡œë“œ (PDF ë˜ëŠ” ì´ë¯¸ì§€)
4. íšŒì›ê°€ì… ë²„íŠ¼ í´ë¦­
5. íŒŒì¼ ì—…ë¡œë“œ ì„±ê³µ â†’ Storageì— ì €ì¥ë¨
6. "ì´ë©”ì¼ í™•ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤" ë©”ì‹œì§€ í™•ì¸
7. ì´ë©”ì¼ í™•ì¸ ë§í¬ í´ë¦­
8. /auth/callbackì—ì„œ:
   - users í…Œì´ë¸”ì— ë°ì´í„° ìƒì„±
   - Storageì—ì„œ íŒŒì¼ í™•ì¸
   - business_registration_url ìë™ ì €ì¥
   - verification_status = 'pending' ì„¤ì •
9. ë¡œê·¸ì¸ ê°€ëŠ¥ (ìŠ¹ì¸ ëŒ€ê¸° ìƒíƒœ)

### 3. ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ (ì‚¬ì—…ì ìŠ¹ì¸):

ì „ì œ ì¡°ê±´: ê´€ë¦¬ì ê³„ì •ì´ í•„ìš” (DBì—ì„œ user_typeì„ 'admin'ìœ¼ë¡œ ìˆ˜ë™ ë³€ê²½)

1. ê´€ë¦¬ì ê³„ì •ìœ¼ë¡œ ë¡œê·¸ì¸
2. http://localhost:3000/admin/dashboard ì ‘ì†
3. ìŠ¹ì¸ ëŒ€ê¸° ì¤‘ì¸ ë„ë§¤ìƒ ëª©ë¡ í™•ì¸
4. ì‚¬ì—…ì ë“±ë¡ì¦ ë¯¸ë¦¬ë³´ê¸° ë²„íŠ¼ í´ë¦­
   - PDFì¸ ê²½ìš°: iframeìœ¼ë¡œ í‘œì‹œ
   - ì´ë¯¸ì§€ì¸ ê²½ìš°: img íƒœê·¸ë¡œ í‘œì‹œ
5. ë‹¤ìš´ë¡œë“œ ë²„íŠ¼ í´ë¦­í•˜ì—¬ íŒŒì¼ ë‹¤ìš´ë¡œë“œ
6. ìŠ¹ì¸ ë²„íŠ¼ í´ë¦­:
   - verification_status = 'approved'
   - ë„ë§¤ìƒì´ ìƒí’ˆ ë“±ë¡ ê°€ëŠ¥í•´ì§
7. ë˜ëŠ” ê±°ë¶€ ë²„íŠ¼ í´ë¦­:
   - verification_status = 'rejected'
   - user_type = 'normal'ë¡œ ë³€ê²½
   - ì¼ë°˜ ì‚¬ìš©ìë¡œ ê°•ë“±

===============================================
## ğŸ“Š í˜„ì¬ ë°ì´í„°ë² ì´ìŠ¤ í˜„í™©
===============================================

### Supabase Auth (auth.users)
- í…ŒìŠ¤íŠ¸ ê³„ì • ìƒì„±ë¨
- ì´ë©”ì¼ í™•ì¸ í•„ìˆ˜

### PostgreSQL Tables

1. users
   - uid (UUID, PK)
   - email (TEXT, UNIQUE)
   - name (TEXT)
   - phone_number (TEXT, nullable)
   - business_registration_url (TEXT, nullable)
   - user_type (TEXT: 'normal', 'wholesaler', 'admin')
   - verification_status (TEXT: 'none', 'pending', 'approved', 'rejected')
   - created_at (TIMESTAMPTZ)
   - updated_at (TIMESTAMPTZ, nullable)

2. products (ëŒ€ê¸°)
3. inquiries (ëŒ€ê¸°)
4. sell_requests (ëŒ€ê¸°)
5. purchase_offers (ëŒ€ê¸°)

### Supabase Storage Buckets

1. business-registrations
   - Public bucket
   - íŒŒì¼ ê²½ë¡œ: {userId}/{userId}_{timestamp}.{ext}
   - ìµœëŒ€ í¬ê¸°: 5MB
   - í—ˆìš© íƒ€ì…: image/jpeg, image/png, application/pdf

2. product-images (ëŒ€ê¸°)
3. sell-request-images (ëŒ€ê¸°)

### Database Triggers

1. handle_new_user()
   - Auth ê°€ì… ì‹œ users í…Œì´ë¸” ìë™ ìƒì„±
   - user_metadataì—ì„œ name, user_type, phone_number ì¶”ì¶œ
   - verification_status ê¸°ë³¸ê°’: 'none'

### Database Functions

1. is_admin()
   - í˜„ì¬ ì‚¬ìš©ìê°€ ê´€ë¦¬ìì¸ì§€ í™•ì¸
   - SECURITY DEFINER, SET search_path, STABLE
   - RLS ì •ì±…ì—ì„œ ì‚¬ìš©

===============================================
## âœ… ë‹¤ìŒ ì‘ì—… ì²´í¬ë¦¬ìŠ¤íŠ¸
===============================================

### Phase 4: ìƒí’ˆ ê¸°ëŠ¥ (ì§„í–‰ ì˜ˆì •)

[ ] 1. ë°ì´í„° ëª¨ë¸ ì •ì˜
    - types/product.ts ìƒì„±
    - Product ì¸í„°í˜ì´ìŠ¤ ì •ì˜

[ ] 2. ìƒí’ˆ ì„œë¹„ìŠ¤ êµ¬í˜„
    - lib/services/product.service.ts
    - createProduct(), getProducts(), getProduct(), updateProduct(), deleteProduct()

[ ] 3. ìƒí’ˆ ëª©ë¡ í™”ë©´
    - app/(main)/products/page.tsx
    - ìƒí’ˆ ì¹´ë“œ ê·¸ë¦¬ë“œ
    - ê²€ìƒ‰ ê¸°ëŠ¥

[ ] 4. ìƒí’ˆ ìƒì„¸ í™”ë©´
    - app/(main)/products/[id]/page.tsx
    - ì´ë¯¸ì§€ ê°¤ëŸ¬ë¦¬
    - ë¬¸ì˜í•˜ê¸° ë²„íŠ¼

[ ] 5. ìƒí’ˆ ë“±ë¡/ìˆ˜ì • í™”ë©´ (ë„ë§¤ìƒë§Œ)
    - app/(main)/products/new/page.tsx
    - app/(main)/products/[id]/edit/page.tsx
    - ì´ë¯¸ì§€ ì—…ë¡œë“œ (Storage)

### Phase 5: ë¬¸ì˜ ì‹œìŠ¤í…œ (ëŒ€ê¸°)

[ ] 1. ë°ì´í„° ëª¨ë¸ ì •ì˜
[ ] 2. ë¬¸ì˜ ì„œë¹„ìŠ¤ êµ¬í˜„
[ ] 3. ë¬¸ì˜ ëª©ë¡ í™”ë©´
[ ] 4. ë¬¸ì˜ ì‘ì„± í¼
[ ] 5. ë‹µë³€ ê¸°ëŠ¥ (ë„ë§¤ìƒ)

### Phase 6: ì—­ê²½ë§¤ ì‹œìŠ¤í…œ (ëŒ€ê¸°)

[ ] 1. ë°ì´í„° ëª¨ë¸ ì •ì˜
[ ] 2. ë§¤ì… ìš”ì²­ ì„œë¹„ìŠ¤ êµ¬í˜„
[ ] 3. ë§¤ì… ìš”ì²­ ë“±ë¡ í™”ë©´
[ ] 4. ë§¤ì… ìš”ì²­ ëª©ë¡ (ë„ë§¤ìƒìš©)
[ ] 5. ë§¤ì… ì œì•ˆ ê¸°ëŠ¥ (ë¸”ë¼ì¸ë“œ)
[ ] 6. ê±°ë˜ í™•ì • ê¸°ëŠ¥

### Phase 7: ë„ë§¤ìƒ ëŒ€ì‹œë³´ë“œ (ëŒ€ê¸°)

[ ] 1. í†µê³„ ë°ì´í„° í‘œì‹œ
[ ] 2. ë“±ë¡ ìƒí’ˆ ëª©ë¡
[ ] 3. ë°›ì€ ë¬¸ì˜ ëª©ë¡
[ ] 4. ë§¤ì… ì œì•ˆ í˜„í™©

===============================================
## ğŸ†˜ ë¬¸ì œ ë°œìƒ ì‹œ ì°¸ê³ 
===============================================

### Supabase í´ë¼ì´ì–¸íŠ¸ Hanging ì‹œ:
â†’ Supabase SDK ì‚¬ìš© ì¤‘ë‹¨
â†’ localStorage + fetch API íŒ¨í„´ ì‚¬ìš©
â†’ lib/services/admin.service.ts ì°¸ê³ 

### RLS ì •ì±… ì—ëŸ¬:
â†’ ì„ì‹œë¡œ RLS DISABLE ë˜ëŠ”
â†’ SECURITY DEFINER í•¨ìˆ˜ ì‚¬ìš©

### ì´ë©”ì¼ í™•ì¸ ì•ˆ ë¨:
â†’ Supabase Dashboard â†’ Authentication â†’ Email Templates í™•ì¸
â†’ Confirm your signup í…œí”Œë¦¿ì˜ Redirect URL í™•ì¸

### Storage ì—…ë¡œë“œ ì—ëŸ¬:
â†’ Service Role Key ì‚¬ìš© (Server-side API)
â†’ app/api/upload-business-registration/route.ts íŒ¨í„´ ì°¸ê³ 

### í™˜ê²½ ë³€ìˆ˜ ë¬¸ì œ:
â†’ .env.local íŒŒì¼ í™•ì¸
â†’ NEXT_PUBLIC_* ë³€ìˆ˜ë§Œ í´ë¼ì´ì–¸íŠ¸ì—ì„œ ì ‘ê·¼ ê°€ëŠ¥
â†’ ì„œë²„ ì¬ì‹œì‘ í•„ìš”

### Supabase CLI ëª…ë ¹ì–´:
```bash
# ë¡œê·¸ì¸
supabase login

# í”„ë¡œì íŠ¸ ì—°ê²°
supabase link --project-ref vqypnenjejbtvvvewxee

# ë§ˆì´ê·¸ë ˆì´ì…˜ ìƒì„±
supabase migration new migration_name

# ë¡œì»¬ DB ì‹œì‘
supabase start

# ë§ˆì´ê·¸ë ˆì´ì…˜ ì ìš©
supabase db push
```

### ë„ì›€ì´ í•„ìš”í•˜ë©´:
- Supabase ë¬¸ì„œ: https://supabase.com/docs
- Next.js ë¬¸ì„œ: https://nextjs.org/docs
- PostgreSQL ë¬¸ì„œ: https://www.postgresql.org/docs/

===============================================
## ğŸ“ ì¤‘ìš” ì½”ë“œ ìœ„ì¹˜
===============================================

### ì¸ì¦ ê´€ë ¨:
- ì„œë¹„ìŠ¤: lib/services/auth.service.ts
- Hook: lib/hooks/use-auth.ts
- ë¡œê·¸ì¸: app/(auth)/login/page.tsx
- íšŒì›ê°€ì…: app/(auth)/signup/page.tsx
- ì½œë°±: app/auth/callback/route.ts

### ê´€ë¦¬ì ê´€ë ¨:
- ì„œë¹„ìŠ¤: lib/services/admin.service.ts
- ëŒ€ì‹œë³´ë“œ: app/(main)/admin/dashboard/page.tsx
- localStorage ì„¸ì…˜: getSessionToken() ë©”ì„œë“œ (line 12-31)

### íŒŒì¼ ì—…ë¡œë“œ ê´€ë ¨:
- API route: app/api/upload-business-registration/route.ts
- ì„œë¹„ìŠ¤: lib/services/storage.service.ts
- íšŒì›ê°€ì… í¼: components/auth/signup-form.tsx

### Supabase ì„¤ì •:
- í´ë¼ì´ì–¸íŠ¸: lib/supabase/config.ts
- í™˜ê²½ ë³€ìˆ˜: .env.local

### Hanging ë¬¸ì œ í•´ê²° íŒ¨í„´:
- AdminService.getSessionToken() (lib/services/admin.service.ts:12-31)
- AuthService.signIn() (lib/services/auth.service.ts:152-221)
- callback route (app/auth/callback/route.ts:38-129)

===============================================
## ğŸ“Š í˜„ì¬ ìƒíƒœ ìš”ì•½
===============================================

ê°œë°œ ì™„ë£Œë„: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ 40%

ì™„ë£Œ:
- ì¸ì¦ ì‹œìŠ¤í…œ (íšŒì›ê°€ì…, ë¡œê·¸ì¸, ì´ë©”ì¼ í™•ì¸) âœ…
- ì‚¬ì—…ì ì¸ì¦ ì‹œìŠ¤í…œ (íŒŒì¼ ì—…ë¡œë“œ, ê´€ë¦¬ì ìŠ¹ì¸) âœ…
- ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ (ìŠ¹ì¸/ê±°ë¶€, íŒŒì¼ ë¯¸ë¦¬ë³´ê¸°/ë‹¤ìš´ë¡œë“œ) âœ…
- Supabase ë§ˆì´ê·¸ë ˆì´ì…˜ âœ…
- Database Triggers âœ…
- RLS ì •ì±… âœ…
- Hanging ë¬¸ì œ í•´ê²° âœ…
- ë¬¸ì„œí™” ì—…ë°ì´íŠ¸ âœ…

ì§„í–‰ ì¤‘:
- ìƒí’ˆ ê¸°ëŠ¥ (ëª©ë¡, ìƒì„¸, ë“±ë¡/ìˆ˜ì •) ğŸ”„

ëŒ€ê¸°:
- ë¬¸ì˜ ì‹œìŠ¤í…œ â³
- ì—­ê²½ë§¤ ì‹œìŠ¤í…œ (ë§¤ì… ìš”ì²­/ì œì•ˆ) â³
- ë„ë§¤ìƒ ëŒ€ì‹œë³´ë“œ â³

ë‹¤ìŒ ë‹¨ê³„:
1. ìƒí’ˆ ê¸°ëŠ¥ êµ¬í˜„
2. ë¬¸ì˜ ì‹œìŠ¤í…œ êµ¬í˜„
3. ì—­ê²½ë§¤ ì‹œìŠ¤í…œ êµ¬í˜„
4. ë„ë§¤ìƒ ëŒ€ì‹œë³´ë“œ êµ¬í˜„
5. UI/UX ê°œì„ 
6. í”„ë¡œë•ì…˜ ë°°í¬

===============================================
## ğŸ‰ ì£¼ìš” ì„±ê³¼
===============================================

1. **Flutter â†’ Next.js ë§ˆì´ê·¸ë ˆì´ì…˜ ì„±ê³µ**
   - Flutter Webì—ì„œ Next.js 14 App Routerë¡œ ì™„ì „ ì „í™˜
   - Firebase â†’ Supabase ë§ˆì´ê·¸ë ˆì´ì…˜ ì™„ë£Œ
   - íƒ€ì… ì•ˆì •ì„± í–¥ìƒ (TypeScript)

2. **Supabase Hanging ë¬¸ì œ í•´ê²°**
   - localStorage ê¸°ë°˜ ì„¸ì…˜ ê´€ë¦¬
   - fetch API ì§ì ‘ í˜¸ì¶œ íŒ¨í„´ í™•ë¦½
   - ì•ˆì •ì ì¸ ì¸ì¦ ì‹œìŠ¤í…œ êµ¬ì¶•

3. **ì²´ê³„ì ì¸ ì‚¬ì—…ì ì¸ì¦ ì‹œìŠ¤í…œ**
   - Server-side íŒŒì¼ ì—…ë¡œë“œ (RLS ìš°íšŒ)
   - ì´ë©”ì¼ í™•ì¸ í›„ ìë™ ì²˜ë¦¬
   - ê´€ë¦¬ì ìŠ¹ì¸/ê±°ë¶€ ì‹œìŠ¤í…œ
   - íŒŒì¼ ë¯¸ë¦¬ë³´ê¸°/ë‹¤ìš´ë¡œë“œ ê¸°ëŠ¥

4. **ì™„ì „í•œ ë¬¸ì„œí™”**
   - í”„ë¡œì íŠ¸ ê°œìš”, êµ¬ì¡°, ë°ì´í„° ëª¨ë¸
   - ì‘ì—… ì§„í–‰ ìƒí™© ê¸°ë¡
   - ë¬¸ì œ í•´ê²° ë°©ë²• ì •ë¦¬

===============================================
ì‘ì—… ì¢…ë£Œ: 2025-11-02
ë‹¤ìŒ ì‘ì—… ì‹œ ì´ íŒŒì¼ì„ ì°¸ê³ í•˜ì—¬ ì´ì–´ì„œ ì§„í–‰í•˜ì„¸ìš”.

í”„ë¡œì íŠ¸ ì™„ì„±ë„: ì¤‘ê°„ (ì¸ì¦/ê´€ë¦¬ì ì™„ë£Œ, ìƒí’ˆ/ë¬¸ì˜/ì—­ê²½ë§¤ ëŒ€ê¸°)
ë°°í¬ ì¤€ë¹„ ìƒíƒœ: ë¶€ë¶„ ì™„ë£Œ (ì¸ì¦ ì‹œìŠ¤í…œë§Œ)
ì¶”ì²œ ë‹¤ìŒ ë‹¨ê³„: ìƒí’ˆ ê¸°ëŠ¥ êµ¬í˜„
===============================================
